const eventBus=new Vue;Vue.filter("toCurrency",function(e){return new Intl.NumberFormat("hu-HU",{style:"currency",currency:"HUF",minimumFractionDigits:0}).format(e)}),Vue.filter("toLocaleDateString",function(e){return new Date(e).toLocaleDateString("hu-HU")}),Vue.filter("toNum",function(e,t){return t?e:parseInt(e)}),Vue.filter("invoiceNumber",function(e){return-1!=e.indexOf("|")&&(e=e.split("|"),e=e[1]),e}),Vue.component("filter-input",{props:{search:{type:String,required:!0}},template:'<input type="text" v-model="filterRow" :search="search" autocomplete="off" placeholder="Search">',data:()=>({filterRow:""}),watch:{filterRow(e){eventBus.$emit("row-filter",{field:this.search,val:e})}}}),Vue.component("filtered-tbody",{props:{invoices:{type:Array,required:!0}},template:'<tbody>        <tr v-for="invoice in invoices" :key="invoice.id" :class="invoice.sale ? \'out\' : \'in\'" v-show="!invoice.hidden">            <td>                <a :href="\'view/\' + invoice.id">                    <i v-if= "invoice.sale" class="fi-arrow-left" ></i>                    <i v-if="!invoice.sale" class="fi-arrow-right"></i>                </a>            </td>            <td>{{invoice.number | invoiceNumber}}</td>            <td>{{invoice.date | toLocaleDateString}}</td>            <td>                <a :href="\'../partners/view/\' + invoice.partner.id">                    <i class="fi-torsos"> {{invoice.partner.name}}</i>                </a></td>            <td><i class="fi-contrast"> {{invoice.storage.name}}</i></td>            <td><i class="fi-book"> {{invoice.invoicetype.name}}</i></td>            <td>{{invoice.items.reduce((total, item) => total + item.price * item.quantity, 0) | toCurrency}}</td>        </tr>        </tbody>',data:()=>({searchResultsCount:0}),created(){eventBus.$on("row-filter",e=>{e?this.invoices.forEach(t=>{t[e.field]?t.hidden=-1==t[e.field].toLowerCase().indexOf(e.val.toLowerCase()):t.hidden=!0}):this.invoices.forEach(e=>{e.hidden=!1}),this.$parent.searchResultsCount=this.invoices.filter(e=>!0!==e.hidden).length})}}),new Vue({el:"table",data:{invoices:[],searchResinvoicest:0},created(){fetch("./api/invoices.json").then(e=>e.json()).then(e=>{e.forEach(e=>{e.hidden=!1,e.partnerName=e.partner.name,e.storageName=e.storage.name,e.invoiceType=e.invoicetype.name}),this.invoices=e,this.searchResultsCount=e.length}).catch(e=>console.log(e))}});