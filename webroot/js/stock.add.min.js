$(function(){let t;$("#storage-id").focus(),$("#__partner-id").blur(function(){$("#items").prop("disabled",!1),partners[$("#partner-id").val()]||$("#sale").prop("checked",!1).change().prop("disabled",!0)}),$("#sale").change(function(){this.checked?($(this).parent().parent().parent().addClass("out").removeClass("in"),$(this).parent().find("span").text(StockTexts.hu.sale),$("td:nth-child(2), th:nth-child(2)").show(),$("td:nth-child(4), th:nth-child(4)").show(),$("td:nth-child(5), th:nth-child(5)").show()):($(this).parent().parent().parent().addClass("in").removeClass("out"),$(this).parent().find("span").text(StockTexts.hu.purchase),$("td:nth-child(2), th:nth-child(2)").hide(),$("td:nth-child(4), th:nth-child(4)").hide(),$("td:nth-child(5), th:nth-child(5)").hide())}),$("form").submit(function(){e()&&$("table tbody tr:last").remove()});let e=function(){return!$("table tbody tr:last").find("input[type=hidden]").val()};$(document).on("focus","input.quantity",function(){t=$(this).parent().parent().prev().prev().find("input[type=hidden]").val();let e=products[t][4],n=products[t][5];$(this).parent().parent().next().html(number_format(e)+" / "+number_format(n)),$(this).parent().parent().next().next().html(number_format(n*(1+partners[$("#partner-id").val()]/100))),!$(this).parent().parent().next().next().next().find("input").val()>0&&$(this).parent().parent().next().next().next().find("input").val(number_format(n*(1+partners[$("#partner-id").val()]/100))),$(this).parent().parent().next().next().next().next().next().text(products[t][3]+" %")}),$(document).on("blur","input.price",function(){let e=str2Num($(this).closest("tr").find("input.quantity").val())*str2Num($(this).val());$(this).parent().parent().next().text(number_format(e));let r=e*(products[t][3]/100);$(this).parent().parent().next().next().next().text(number_format(r)),$(this).parent().parent().next().next().next().next().text(number_format(e+r)),n($(this).closest("tbody"))});let n=function(t){if($("tfoot tr").children().each(function(t,e){let n=0;6!=t&&8!=t&&9!=t||($(e).closest("table").find("tbody tr td:nth-child("+(t+1)+")").each(function(t,e){n+=str2Num($(e).text())}),$(e).text(number_format(n)))}),!e()){let e=t.children("tr:first"),n=t.children("tr").length;e=e.prop("outerHTML").replace(/items\-0/g,"items-"+n).replace(/items\[0\]/g,"items["+n+"]").replace(/ value="[!"]*"/,' value=""').replace(/td class="text-right">[0-9\.,\/ %]*?<\/td/g,'td class="text-right"></td'),t.append(e)}t.find("datalist:last").prev().focus()}});